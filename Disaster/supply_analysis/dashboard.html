<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ê³µê¸‰ë˜ëŠ” ì—ë„ˆì§€ ë¶„ì„</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            min-height: 100vh; 
            padding: 20px; 
        }
        .container { 
            max-width: 1600px; 
            margin: 0 auto; 
            background: white; 
            padding: 40px; 
            border-radius: 16px; 
            box-shadow: 0 20px 60px rgba(0,0,0,0.3); 
        }
        .header { 
            text-align: center; 
            margin-bottom: 40px; 
            padding-bottom: 30px; 
            border-bottom: 3px solid #FF6B35; 
        }
        h1 { 
            color: #FF6B35; 
            font-size: 3em; 
            margin-bottom: 15px; 
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1); 
        }
        .status-badge { 
            display: inline-block; 
            padding: 12px 24px; 
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%); 
            color: white; 
            border-radius: 25px; 
            font-weight: bold; 
            margin-top: 15px; 
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3); 
        }
        .stats-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); 
            gap: 25px; 
            margin-bottom: 40px; 
        }
        .stat-card { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            color: white; 
            padding: 30px; 
            border-radius: 15px; 
            box-shadow: 0 8px 25px rgba(0,0,0,0.2); 
            transition: transform 0.3s ease, box-shadow 0.3s ease; 
            position: relative; 
            overflow: hidden; 
        }
        .stat-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: pulse 3s ease-in-out infinite;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.5; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 35px rgba(0,0,0,0.3);
        }
        .stat-card h3 { 
            font-size: 1em; 
            opacity: 0.95; 
            margin-bottom: 15px; 
            font-weight: 500; 
        }
        .stat-card .value { 
            font-size: 2.5em; 
            font-weight: bold; 
            margin-bottom: 5px; 
        }
        .stat-card .unit {
            font-size: 0.9em;
            opacity: 0.9;
        }
        .charts-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr)); 
            gap: 30px; 
            margin-bottom: 40px; 
        }
        .chart-card { 
            background: white; 
            padding: 30px; 
            border-radius: 15px; 
            box-shadow: 0 8px 25px rgba(0,0,0,0.15); 
            border: 2px solid #e0e0e0; 
            transition: transform 0.3s ease, box-shadow 0.3s ease; 
            min-height: 450px;
        }
        .chart-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(0,0,0,0.2);
            border-color: #FF6B35;
        }
        .chart-card h3 { 
            color: #333; 
            margin-bottom: 20px; 
            font-size: 1.4em; 
            font-weight: 600; 
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .chart-card h3::before {
            content: '';
            width: 4px;
            height: 25px;
            background: linear-gradient(135deg, #FF6B35 0%, #667eea 100%);
            border-radius: 2px;
        }
        .chart-container { 
            position: relative; 
            height: 350px; 
        }
        .info-section {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 30px;
            border-radius: 15px;
            margin-top: 30px;
            border-left: 5px solid #FF6B35;
        }
        .info-section h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.3em;
        }
        .info-section p {
            color: #666;
            line-height: 1.6;
        }
        #anomalyAlert {
            margin-top: 15px;
            padding: 15px;
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            border-radius: 5px;
            display: none;
        }
        .anomaly-item {
            display: inline-block;
            margin: 5px;
            padding: 8px 12px;
            background: #fff;
            border-radius: 5px;
            border-left: 3px solid #dc3545;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>âš¡ ê³µê¸‰ë˜ëŠ” ì—ë„ˆì§€ ë¶„ì„</h1>
            <div class="status-badge">âœ… ì‹¤ì‹œê°„ ë°ì´í„° ëª¨ë‹ˆí„°ë§ ì¤‘</div>
        </div>
        
        <div class="stats-grid">
            <div class="stat-card">
                <h3>ì´ ì „ë ¥ ìƒì‚°ëŸ‰</h3>
                <div class="value" id="totalProduction">-</div>
                <div class="unit">kWh</div>
            </div>
            <div class="stat-card">
                <h3>í‰ê·  ì „ë ¥ ìƒì‚°</h3>
                <div class="value" id="avgProduction">-</div>
                <div class="unit">kW</div>
            </div>
            <div class="stat-card">
                <h3>ìµœëŒ€ ì „ë ¥ ìƒì‚°</h3>
                <div class="value" id="maxProduction">-</div>
                <div class="unit">kW</div>
            </div>
            <div class="stat-card">
                <h3>íƒœì–‘ê´‘ íŒ¨ë„ ìˆ˜</h3>
                <div class="value" id="panelCount">-</div>
                <div class="unit">ê°œ</div>
            </div>
        </div>
        
        <div class="charts-grid">
            <div class="chart-card">
                <h3>ğŸ“Š ì‹œê°„ë³„ ì „ë ¥ ìƒì‚° ì¶”ì´ (ì˜¤ëŠ˜)</h3>
                <div class="chart-container">
                    <canvas id="timeChart"></canvas>
                </div>
            </div>
            <div class="chart-card">
                <h3>ğŸ“ˆ ì¼ë³„ ì „ë ¥ ìƒì‚°ëŸ‰ (ìµœê·¼ 7ì¼)</h3>
                <div class="chart-container">
                    <canvas id="dailyChart"></canvas>
                </div>
            </div>
            <div class="chart-card">
                <h3>ğŸ“‰ íŒë„¬ë³„ ìƒì‚°ëŸ‰ ë¶„í¬</h3>
                <div class="chart-container">
                    <canvas id="panelChart"></canvas>
                </div>
                <div id="anomalyAlert">
                    <strong>âš ï¸ ì´ìƒ íƒì§€:</strong> <span id="anomalyCount">0</span>ê°œì˜ íŒë„¬ì—ì„œ ì´ìƒì´ ê°ì§€ë˜ì—ˆìŠµë‹ˆë‹¤.
                    <div id="anomalyList" style="margin-top: 10px;"></div>
                </div>
            </div>
            <div class="chart-card">
                <h3>ğŸ”¥ ì›”ë³„ ì „ë ¥ ìƒì‚° ì¶”ì´ (7-10ì›”)</h3>
                <div class="chart-container">
                    <canvas id="monthlyChart"></canvas>
                </div>
            </div>
        </div>
        
        <div class="info-section">
            <h3>ğŸ“Œ ëŒ€ì‹œë³´ë“œ ì •ë³´</h3>
            <p>ì´ ëŒ€ì‹œë³´ë“œëŠ” 50kW íƒœì–‘ê´‘ ì‹œìŠ¤í…œì˜ ì‹¤ì‹œê°„ ì—ë„ˆì§€ ê³µê¸‰ ë°ì´í„°ë¥¼ ì‹œê°í™”í•˜ì—¬ ì œê³µí•©ë‹ˆë‹¤. 7ì›”ë¶€í„° 10ì›”ê¹Œì§€ì˜ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•˜ë©°, ì‹œê°„ë³„, ì¼ë³„, íŒë„¬ë³„, ì›”ë³„ ìƒì‚° ì¶”ì´ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ìƒ íƒì§€ ê¸°ëŠ¥ì„ í†µí•´ ë¹„ì •ìƒì ì¸ íŒë„¬ì„ ìë™ìœ¼ë¡œ ê°ì§€í•©ë‹ˆë‹¤.</p>
        </div>
    </div>
    
    <script>
        // 50kW Solar Panel System Data
        const systemCapacity = 50; // kW
        const panelCount = 125; // 50kW / 0.4kW per panel = 125 panels
        const monthlyData = {
            "7ì›”": 13500,
            "8ì›”": 12400,
            "9ì›”": 9750,
            "10ì›”": 8250
        };
        
        const totalProduction = Object.values(monthlyData).reduce((a, b) => a + b, 0);
        const daysInPeriod = 122; // July-October days
        const avgDaily = totalProduction / daysInPeriod;
        const avgProduction = avgDaily / 24;
        const maxProduction = systemCapacity;
        
        // Update stat cards
        document.getElementById("totalProduction").textContent = totalProduction.toLocaleString();
        document.getElementById("avgProduction").textContent = Math.round(avgProduction * 10) / 10;
        document.getElementById("maxProduction").textContent = maxProduction;
        document.getElementById("panelCount").textContent = panelCount.toLocaleString();
        
        // Get current date and time
        const now = new Date();
        const today = now.toLocaleDateString('ko-KR');
        const currentHour = now.getHours();
        
        // Generate realistic hourly data for today (based on solar production pattern)
        // Solar production peaks around noon and decreases toward evening
        const timeSeriesData = [];
        for (let i = 0; i <= currentHour; i++) {
            let production = 0;
            if (i >= 6 && i <= 18) {
                // Peak hours: 6 AM to 6 PM
                const hourFromStart = i - 6;
                const peakHour = 12; // Peak at noon
                const distanceFromPeak = Math.abs(hourFromStart - 6);
                // Bell curve pattern
                production = maxProduction * Math.exp(-Math.pow(distanceFromPeak, 2) / 8);
            }
            production = Math.max(0, production + (Math.random() * 5 - 2.5)); // Add some variation
            timeSeriesData.push({
                time: String(i).padStart(2, '0') + ':00',
                production: production
            });
        }
        
        // Generate daily data for last 7 days (based on avgDaily with variation)
        const dailyData = [];
        for (let i = 6; i >= 0; i--) {
            const date = new Date(now);
            date.setDate(date.getDate() - i);
            const dayNames = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
            const variation = 0.8 + Math.random() * 0.4; // 80-120% variation
            dailyData.push({
                day: dayNames[date.getDay()],
                date: date.toLocaleDateString('ko-KR', { month: 'short', day: 'numeric' }),
                production: avgDaily * variation
            });
        }
        
        // Panel data (125 panels, 400W each)
        const panelData = [];
        const panelNames = [];
        for (let i = 1; i <= 125; i++) {
            panelNames.push("íŒë„¬ " + i);
            // Base production per panel: avgProduction / panelCount
            const baseProduction = (avgProduction / panelCount) * 1000; // Convert to W
            const variation = 0.7 + Math.random() * 0.6; // 70-130% variation
            panelData.push(baseProduction * variation);
        }
        
        // Anomaly detection
        const meanProduction = panelData.reduce((a, b) => a + b, 0) / panelData.length;
        const stdDev = Math.sqrt(panelData.reduce((sum, val) => sum + Math.pow(val - meanProduction, 2), 0) / panelData.length);
        const lowerBound = meanProduction - 2 * stdDev;
        const upperBound = meanProduction + 2 * stdDev;
        
        const anomalies = [];
        const panelDataWithAnomaly = panelData.map((prod, index) => {
            const isAnomaly = prod < lowerBound || prod > upperBound;
            if (isAnomaly) {
                anomalies.push({
                    panel: panelNames[index],
                    production: Math.round(prod),
                    type: prod < lowerBound ? 'ì €ìƒì‚°' : 'ê³ ìƒì‚°'
                });
            }
            return {
                name: panelNames[index],
                production: prod,
                isAnomaly: isAnomaly
            };
        });
        
        // Select top 6 panels for chart (including anomalies)
        const sortedPanels = [...panelDataWithAnomaly].sort((a, b) => {
            if (a.isAnomaly && !b.isAnomaly) return -1;
            if (!a.isAnomaly && b.isAnomaly) return 1;
            return Math.abs(b.production - meanProduction) - Math.abs(a.production - meanProduction);
        });
        const chartPanels = sortedPanels.slice(0, 6);
        
        // Chart configuration
        const chartOptions = {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: true,
                    position: "top",
                    labels: {
                        font: {
                            size: 12,
                            weight: 'bold'
                        },
                        padding: 15
                    }
                },
                tooltip: {
                    backgroundColor: 'rgba(0, 0, 0, 0.8)',
                    padding: 12,
                    titleFont: {
                        size: 14,
                        weight: 'bold'
                    },
                    bodyFont: {
                        size: 12
                    },
                    cornerRadius: 8
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    grid: {
                        color: 'rgba(0, 0, 0, 0.1)'
                    },
                    ticks: {
                        font: {
                            size: 11
                        }
                    }
                },
                x: {
                    grid: {
                        color: 'rgba(0, 0, 0, 0.05)'
                    },
                    ticks: {
                        font: {
                            size: 11
                        }
                    }
                }
            }
        };
        
        // Time series chart (Today)
        if (typeof Chart !== 'undefined') {
            new Chart(document.getElementById("timeChart"), {
                type: "line",
                data: {
                    labels: timeSeriesData.map(d => d.time),
                    datasets: [{
                        label: "ì „ë ¥ ìƒì‚°ëŸ‰ (kW)",
                        data: timeSeriesData.map(d => d.production),
                        borderColor: "rgb(255, 107, 53)",
                        backgroundColor: "rgba(255, 107, 53, 0.1)",
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 4,
                        pointHoverRadius: 6,
                        pointBackgroundColor: "rgb(255, 107, 53)",
                        pointBorderColor: "#fff",
                        pointBorderWidth: 2
                    }]
                },
                options: {
                    ...chartOptions,
                    plugins: {
                        ...chartOptions.plugins,
                        title: {
                            display: true,
                            text: 'ì˜¤ëŠ˜ (' + today + ') ì‹¤ì‹œê°„ ìƒì‚° ì¶”ì´',
                            font: {
                                size: 14,
                                weight: 'bold'
                            },
                            padding: {
                                bottom: 20
                            }
                        }
                    }
                }
            });
            
            // Daily chart (Last 7 days)
            new Chart(document.getElementById("dailyChart"), {
                type: "bar",
                data: {
                    labels: dailyData.map(d => d.day + ' (' + d.date + ')'),
                    datasets: [{
                        label: "ì „ë ¥ ìƒì‚°ëŸ‰ (kWh)",
                        data: dailyData.map(d => d.production),
                        backgroundColor: "rgba(102, 126, 234, 0.8)",
                        borderColor: "rgb(102, 126, 234)",
                        borderWidth: 2,
                        borderRadius: 8
                    }]
                },
                options: chartOptions
            });
            
            // Panel chart with anomaly detection
            const panelColors = chartPanels.map((panel) => {
                if (panel.isAnomaly) {
                    return panel.production < lowerBound ? 
                        "rgba(255, 0, 0, 0.8)" : 
                        "rgba(255, 165, 0, 0.8)";
                }
                return "rgba(102, 126, 234, 0.8)";
            });
            
            const panelBorderColors = chartPanels.map((panel) => {
                if (panel.isAnomaly) {
                    return panel.production < lowerBound ? 
                        "rgb(255, 0, 0)" : 
                        "rgb(255, 165, 0)";
                }
                return "rgb(102, 126, 234)";
            });
            
            new Chart(document.getElementById("panelChart"), {
                type: "doughnut",
                data: {
                    labels: chartPanels.map(d => d.name + (d.isAnomaly ? ' âš ï¸' : '')),
                    datasets: [{
                        label: "ìƒì‚°ëŸ‰ (W)",
                        data: chartPanels.map(d => d.production),
                        backgroundColor: panelColors,
                        borderColor: panelBorderColors,
                        borderWidth: chartPanels.map(d => d.isAnomaly ? 5 : 3)
                    }]
                },
                options: {
                    ...chartOptions,
                    plugins: {
                        ...chartOptions.plugins,
                        legend: {
                            ...chartOptions.plugins.legend,
                            position: 'right',
                            labels: {
                                ...chartOptions.plugins.legend.labels,
                                generateLabels: function(chart) {
                                    const data = chart.data;
                                    if (data.labels.length && data.datasets.length) {
                                        return data.labels.map((label, i) => {
                                            const dataset = data.datasets[0];
                                            const value = dataset.data[i];
                                            const isAnomaly = chartPanels[i].isAnomaly;
                                            return {
                                                text: label + ' - ' + Math.round(value) + ' W' + (isAnomaly ? ' (âš ï¸ ì´ìƒ)' : ''),
                                                fillStyle: dataset.backgroundColor[i],
                                                strokeStyle: dataset.borderColor[i],
                                                lineWidth: dataset.borderWidth[i] || 2,
                                                fontColor: isAnomaly ? '#dc3545' : '#666',
                                                fontWeight: isAnomaly ? 'bold' : 'normal'
                                            };
                                        });
                                    }
                                    return [];
                                }
                            }
                        }
                    }
                }
            });
            
            // Monthly chart (July-October)
            new Chart(document.getElementById("monthlyChart"), {
                type: "line",
                data: {
                    labels: Object.keys(monthlyData),
                    datasets: [{
                        label: "ì „ë ¥ ìƒì‚°ëŸ‰ (kWh)",
                        data: Object.values(monthlyData),
                        borderColor: "rgb(102, 126, 234)",
                        backgroundColor: "rgba(102, 126, 234, 0.1)",
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 5,
                        pointHoverRadius: 7,
                        pointBackgroundColor: "rgb(102, 126, 234)",
                        pointBorderColor: "#fff",
                        pointBorderWidth: 2
                    }]
                },
                options: chartOptions
            });
            
            // Display anomaly alert
            if (anomalies.length > 0) {
                document.getElementById("anomalyAlert").style.display = 'block';
                document.getElementById("anomalyCount").textContent = anomalies.length;
                const anomalyList = anomalies.map(a => 
                    '<span class="anomaly-item"><strong>' + a.panel + '</strong>: ' + a.production + ' W (' + a.type + ')</span>'
                ).join('');
                document.getElementById("anomalyList").innerHTML = anomalyList;
            }
        } else {
            console.error('Chart.js not loaded');
            document.querySelectorAll('.chart-container').forEach(container => {
                container.innerHTML = '<p style="text-align: center; color: #999; padding: 50px;">ì°¨íŠ¸ë¥¼ ë¡œë“œí•˜ëŠ” ì¤‘...</p>';
            });
        }
    </script>
</body>
</html>